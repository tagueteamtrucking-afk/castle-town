<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Palace — Throne Room</title>
<link rel="stylesheet" href="../asset/css/style.css"/>
<style>html,body{height:100%}#scene{width:100vw;height:100vh}</style>
</head>
<body>
<div class="topbar"><a href="../pages/plaza.html">← Plaza</a></div>
<canvas id="scene"></canvas><div id="hud">Booting…</div>

<script type="module">
const VER="0.152.2";
const THREE_URL=`https://esm.sh/three@${VER}`;
const ORBIT_URL=`https://esm.sh/three@${VER}/examples/jsm/controls/OrbitControls.js`;
const GLTF_URL=`https://esm.sh/three@${VER}/examples/jsm/loaders/GLTFLoader.js`;
const VRM_URL=`https://esm.sh/@pixiv/three-vrm@2.0.7?deps=three@${VER}`;

const T=await import(THREE_URL);
const {OrbitControls}=await import(ORBIT_URL);
const {GLTFLoader}=await import(GLTF_URL);
const {VRMLoaderPlugin}=await import(VRM_URL);

const hud=document.getElementById('hud');
const log=(m,c="")=>{const d=document.createElement('div');if(c)d.className=c;d.innerHTML=m;hud.appendChild(d);hud.scrollTop=hud.scrollHeight;};

const canvas=document.getElementById('scene');
const R=new T.WebGLRenderer({canvas,antialias:true,alpha:true});R.setPixelRatio(1.0);R.setSize(innerWidth,innerHeight);
const S=new T.Scene();const C=new T.PerspectiveCamera(42,innerWidth/innerHeight,.1,1200);C.position.set(0,1.6,4.2);
const ctl=new OrbitControls(C,R.domElement);ctl.target.set(0,1.5,0);ctl.enableDamping=true;

S.add(new T.HemisphereLight(0xffffff,0x223344,.9));const sun=new T.DirectionalLight(0xffffff,1.0);sun.position.set(3,6,3);S.add(sun);

const dais=new T.Mesh(new T.CylinderGeometry(2.5,2.6,.25,48),new T.MeshStandardMaterial({color:0x202234,metalness:.2,roughness:.85}));dais.position.y=.125;S.add(dais);
const throneL=new T.Mesh(new T.BoxGeometry(0.9,1.2,0.5),new T.MeshStandardMaterial({color:0x2f3357}));throneL.position.set(-1,0.6,-0.3);S.add(throneL);
const throneR=throneL.clone();throneR.position.x=1;S.add(throneR);

const loader=new GLTFLoader();loader.register(p=>new VRMLoaderPlugin(p));

async function addVRM(url,x){
  try{const g=await new Promise((res,rej)=>loader.load(url,res,undefined,rej));
    const vrm=g.userData.vrm; vrm.scene.position.x=x; vrm.scene.traverse(o=>{if(o.isMesh){o.frustumCulled=false;}});S.add(vrm.scene);log("✅ "+url);}
  catch(e){log("❌ "+url+" "+e,"err");}
}
await addVRM("../asset/models/whitestar.vrm?v=5",-1.1);
await addVRM("../asset/models/reyczar.vrm?v=5",1.1);

addEventListener("resize",()=>{C.aspect=innerWidth/innerHeight;C.updateProjectionMatrix();R.setSize(innerWidth,innerHeight);});
(function loop(){ctl.update();R.render(S,C);requestAnimationFrame(loop);})();
</script>
</body></html>
