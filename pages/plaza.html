<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Plaza — Fantasy Castle Town</title>
<link rel="stylesheet" href="../asset/css/style.css"/>
<style>
#hud{position:fixed;right:.75rem;bottom:.75rem;max-width:60vw;max-height:40vh;overflow:auto;
     font:12px/1.35 ui-monospace,Menlo,monospace;background:rgba(0,0,0,.65);color:#eaeaff;
     padding:.6rem .7rem;border:1px solid rgba(255,255,255,.18);border-radius:.5rem;
     backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);z-index:9999}
#hud b{color:#a5d6ff}.ok{color:#7dff9b}.err{color:#ff8aa5}
#scene{display:block;width:100vw;height:100vh;background:transparent}
.topbar{position:fixed;left:0;right:0;top:0;display:flex;gap:.6rem;flex-wrap:wrap;justify-content:center;
        padding:.5rem;background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0));z-index:9998}
.topbar a{font:600 13px system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:.35rem .6rem;border-radius:.45rem;
          text-decoration:none;background:rgba(255,255,255,.08);color:#e6e9ff;border:1px solid rgba(255,255,255,.15)}
.topbar a:hover{background:rgba(255,255,255,.15)}
html,body{height:100%}
</style></head><body>
<div class="topbar">
  <a href="../buildings/palace.html">Palace — White Star & ReyCzar</a>
  <a href="../buildings/abbey.html">Abbey — Grand Vault (Treasure)</a>
  <a href="../buildings/billie.html">Billie — Mansion (Stock Wall)</a>
  <a href="../buildings/odessa.html">Odessa — Museum Mansion</a>
  <a href="../buildings/sorcha.html">Sorcha — Influencer Screening</a>
  <a href="../buildings/nina.html">Nina — Cyber/Steampunk Lab</a>
  <a href="../buildings/charlotte.html">Charlotte — Relay Tower</a>
  <a href="../buildings/themis.html">Themis — Compliance (Records)</a>
  <a href="../buildings/clarice.html">Clarice — City Hall (Judge)</a>
  <a href="../buildings/carol.html">Carol — Restaurant (Dojo)</a>
  <a href="../buildings/jem.html">Jem — Dojo</a>
  <a href="../buildings/stella.html">Stella — Observatory/Apothecary</a>
  <a href="../buildings/tracy.html">Tracy — Cathedral Studio</a>
  <a href="../buildings/alexandria.html">Alexandria — Library</a>
</div>
<canvas id="scene"></canvas><div id="hud">Booting…</div>
<script type="module">
const hud=document.getElementById('hud');const log=(m,c="")=>{const p=document.createElement('div');if(c)p.className=c;p.innerHTML=m;hud.appendChild(p);hud.scrollTop=hud.scrollHeight;};
const VER="0.152.2", THREE=`https://esm.sh/three@${VER}`, ORB=`https://esm.sh/three@${VER}/examples/jsm/controls/OrbitControls.js`,
      GLTF=`https://esm.sh/three@${VER}/examples/jsm/loaders/GLTFLoader.js`, VRM=`https://esm.sh/@pixiv/three-vrm@2.0.7?deps=three@${VER}`;
let T,OrbitControls,GLTFLoader,VRMMod;try{
  T=await import(THREE);({OrbitControls}=await import(ORB));
  ({GLTFLoader}=await import(GLTF));VRMMod=await import(VRM);
  log(`✅ <b>Imports OK</b> — three@${VER} / three-vrm@2.0.7`,"ok");
}catch(e){log(`❌ <b>Import failed</b>: ${e?.message||e}`,"err");throw e;}
const canvas=document.getElementById('scene'),
      r=new T.WebGLRenderer({canvas,antialias:true,alpha:true});
r.setPixelRatio(Math.min(devicePixelRatio,2));r.setSize(innerWidth,innerHeight);
const scene=new T.Scene(), cam=new T.PerspectiveCamera(40,innerWidth/innerHeight,.1,1000);
cam.position.set(0,1.6,7);
const ctl=new OrbitControls(cam,r.domElement);ctl.target.set(0,1.4,0);ctl.enableDamping=true;
scene.add(new T.HemisphereLight(0xffffff,0x444466,0.7));
const d=new T.DirectionalLight(0xffffff,0.9);d.position.set(3,6,2);scene.add(d);
const ground=new T.Mesh(new T.CircleGeometry(7,72),new T.MeshStandardMaterial({color:0x1a1a1f,metalness:.05,roughness:.95}));
ground.rotation.x=-Math.PI/2;ground.receiveShadow=true;scene.add(ground);

const names=["stella","tracy","alexandria","jem","carol","nina","charlotte","abbey","billie","odessa","sorcha","themis","clarice","whitestar","reyczar"];
const L=new GLTFLoader(), vrms=[];
const place=()=>{const R=3.8;vrms.forEach((v,i)=>{const t=i/Math.max(1,vrms.length)*Math.PI*2;v.scene.position.set(Math.cos(t)*R,0,Math.sin(t)*R);v.scene.lookAt(0,1.4,0);});};
const load=u=>new Promise((res,rej)=>{L.load(u,(g)=>{VRMMod.VRM.from(g).then(v=>{v.scene.traverse(o=>{if(o.isMesh){o.frustumCulled=false;o.castShadow=true;o.receiveShadow=true;}});scene.add(v.scene);vrms.push(v);place();res(v);}).catch(rej);},undefined,(e)=>rej(e));});
let any=false;
for(const n of names){
  const url=`../asset/models/${n}.vrm`;
  try{
    const h=await fetch(url,{method:"HEAD",cache:"no-store"});
    if(!h.ok){log(`↳ (missing) <code>${url}</code> — ${h.status}`);continue;}
    await load(url);log(`✅ <span class="ok">Loaded</span> <code>${n}.vrm</code>`,"ok");any=true;
  }catch(e){log(`❌ <span class="err">Failed</span> <code>${n}.vrm</code> — ${e?.message||e}`,"err");}
}
if(!any){
  const sample="https://pixiv.github.io/three-vrm/examples/models/VRM/AliciaSolid.vrm";
  log(`<b>No local VRMs found.</b> Loading sample…`);
  try{await load(sample);log(`✅ <span class="ok">Sample VRM loaded</span>`,"ok");}catch(e){log(`❌ <span class="err">Sample failed</span> — ${e?.message||e}`,"err");}
}
addEventListener('resize',()=>{cam.aspect=innerWidth/innerHeight;cam.updateProjectionMatrix();r.setSize(innerWidth,innerHeight);});
(function ani(){ctl.update();r.render(scene,cam);requestAnimationFrame(ani);})();
</script></body></html>
